<!--
 Copyright 2025 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<div class="step-content domain-config-step-content">
  <h2>Domain Configuration</h2>
  <p class="subtitle">Configure the domain names for your deployed components.</p>

  <form [formGroup]="domainConfigForm" class="domain-form">
    <mat-tab-group [selectedIndex]="currentInternalStep - 1" (selectedTabChange)="onTabChange($event)" animationDuration="0ms">

      <mat-tab label="1. Subdomains" [disabled]="!isStep1Enabled()">
        <ng-template matTabContent>
          <div class="internal-step-page">
            <h3>Define Subdomain for Components</h3>
            <div formArrayName="componentPrefixes" class="component-subdomains-container">
              <div *ngFor="let compPrefixGroup of componentPrefixes.controls; let i = index" [formGroupName]="i" class="domain-prefix-card mat-elevation-z1">
                <h4>{{ compPrefixGroup.get('component')?.value | titlecase }}</h4>
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ compPrefixGroup.get('component')?.value | titlecase }}</mat-label>
                  <input matInput formControlName="subdomainPrefix" required
                         placeholder="e.g., {{ compPrefixGroup.get('component')?.value }}">
                  <mat-error *ngIf="getErrorMessage(compPrefixGroup.get('subdomainPrefix') ?? null, 'Subdomain Prefix')">{{ getErrorMessage(compPrefixGroup.get('subdomainPrefix') ?? null, 'Subdomain Prefix') }}</mat-error>
                </mat-form-field>
              </div>
            </div>
          </div>
        </ng-template>
      </mat-tab>

      <mat-tab label="2. Domain Type" [disabled]="!isStep2Enabled()">
        <ng-template matTabContent>
          <div class="internal-step-page" [formGroup]="globalDomainDetailsFormGroup">
            <h3>Choose Your Domain Registration Type</h3>
            <p>Where is your base domain registered?</p>

            <div class="form-row domain-type-selection-global">
              <mat-radio-group formControlName="domainType" aria-label="Select global domain type">
                <mat-radio-button value="google_domain">Google Cloud DNS Managed Domain</mat-radio-button>
                <mat-radio-button value="other_domain">Other Domain Provider</mat-radio-button>
              </mat-radio-group>
              <mat-error *ngIf="getErrorMessage(globalDomainDetailsFormGroup.get('domainType') ?? null, 'Domain Type')">{{ getErrorMessage(globalDomainDetailsFormGroup.get('domainType') ?? null, 'Domain Type') }}</mat-error>
            </div>
          </div>
        </ng-template>
      </mat-tab>

      <mat-tab label="3. Domain Details" [disabled]="!isStep3Enabled()">
        <ng-template matTabContent>
          <div class="internal-step-page" [formGroup]="globalDomainDetailsFormGroup">
            <h3>Provide Domain Details</h3>

            <div *ngIf="globalDomainDetailsFormGroup.get('domainType')?.value === 'google_domain'" class="domain-type-fields google-domain-details">
              <h4>Google Cloud DNS Details</h4>
              <p>Please provide the base domain name and the Google Cloud DNS Managed Zone name.</p>
              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Base Domain</mat-label>
                  <input matInput formControlName="baseDomain" placeholder="e.g., example.com" required>
                  <mat-error *ngIf="getErrorMessage(globalDomainDetailsFormGroup.get('baseDomain') ?? null, 'Base Domain')">{{ getErrorMessage(globalDomainDetailsFormGroup.get('baseDomain') ?? null, 'Base Domain') }}</mat-error>
                </mat-form-field>
              </div>
              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>DNS Managed Zone</mat-label>
                  <input matInput formControlName="dnsZone" placeholder="e.g., my-domain-zone" required>
                  <mat-error *ngIf="getErrorMessage(globalDomainDetailsFormGroup.get('dnsZone') ?? null, 'DNS Managed Zone')">{{ getErrorMessage(globalDomainDetailsFormGroup.get('dnsZone') ?? null, 'DNS Managed Zone') }}</mat-error>
                </mat-form-field>
              </div>
            </div>

            <div *ngIf="globalDomainDetailsFormGroup.get('domainType')?.value === 'other_domain'" class="domain-type-fields other-domain-details">
              <div class="action-required-box">
                <h4>Action Required</h4>
                <p>Your Global IP address is <strong>{{ installerState.appExternalIp || 'N/A' }}</strong>. Please create 'A' records in your domain provider's DNS settings for all the subdomains you define, pointing them to this IP address.</p>
                <mat-checkbox formControlName="actionRequiredAcknowledged">
                  I acknowledge that I must manually create DNS 'A' records.
                </mat-checkbox>
                <mat-error *ngIf="getErrorMessage(globalDomainDetailsFormGroup.get('actionRequiredAcknowledged') ?? null, 'Acknowledgment')">{{ getErrorMessage(globalDomainDetailsFormGroup.get('actionRequiredAcknowledged') ?? null, 'Acknowledgment') }}</mat-error>
              </div>
            </div>
          </div>
        </ng-template>
      </mat-tab>

    </mat-tab-group>
  </form>

 <div class="step-navigation-buttons">
  <button mat-stroked-button (click)="onBackInternal()">Back</button>
  <button mat-raised-button color="primary" class="action-button"
          [disabled]="!isCurrentStepValid()"
          (click)="onNextInternal()">
    {{ currentInternalStep < totalInternalSteps ? 'Next' : 'Next: App Config' }} <mat-icon *ngIf="currentInternalStep < totalInternalSteps">arrow_forward</mat-icon>
  </button>
</div>
</div>